<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>ùó†ùó¨ ùóïùó¢ùó¢ùóûùó†ùóîùó•ùóûùó¶</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            height: 100vh;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 600px;
            height: 100vh;
            max-height: 100vh;
            margin: 0 auto;
            background: white;
            border-radius: 0;
            padding: 20px;
            box-shadow: none;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        h1 i {
            color: #667eea;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            flex-shrink: 0;
        }

        /* Search Section */
        .search-section {
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .search-box {
            position: relative;
            width: 100%;
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 15px;
            z-index: 1;
        }

        .search-box input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-stats {
            margin-top: 5px;
            font-size: 12px;
            color: #666;
            text-align: left;
        }

        .search-match {
            color: #667eea;
            font-weight: 600;
        }

        .bookmarks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .bookmarks-header h2 {
            color: #333;
            font-size: 18px;
        }

        .bookmarks-count {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 13px;
        }

        /* Scrollable Bookmarks List - Takes remaining space */
        .bookmarks-wrapper {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            border-radius: 10px;
            background: #f8f9fa;
            padding: 5px;
            margin-bottom: 5px;
        }

        .bookmarks-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        /* Custom Scrollbar */
        .bookmarks-wrapper::-webkit-scrollbar {
            width: 4px;
        }

        .bookmarks-wrapper::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .bookmarks-wrapper::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        .bookmarks-wrapper::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Firefox Scrollbar */
        .bookmarks-wrapper {
            scrollbar-width: thin;
            scrollbar-color: #c1c1c1 #f1f1f1;
        }

        .bookmark-item {
            background: white;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            animation: slideIn 0.3s ease;
            border: 2px solid black;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            cursor: pointer; /* Add pointer cursor to indicate clickable */
        }

        .bookmark-item:hover {
            background: #f5f5f5;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .bookmark-item:active {
            transform: translateY(0);
            background: #e8e8e8;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .favicon {
            width: 28px;
            height: 28px;
            min-width: 28px;
            border-radius: 6px;
            overflow: hidden;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e0e0e0;
            pointer-events: none; /* So clicks go to parent */
        }

        .favicon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .favicon i {
            font-size: 16px;
            color: #667eea;
        }

        .bookmark-content {
            flex: 1;
            min-width: 0;
            pointer-events: none; /* So clicks go to parent */
        }

        .bookmark-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bookmark-title mark {
            background: #ffd700;
            color: #333;
            padding: 1px 0;
            border-radius: 2px;
        }

        .bookmark-url {
            color: #666;
            font-size: 11px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bookmark-url mark {
            background: #ffd700;
            color: #333;
            padding: 1px 0;
            border-radius: 2px;
        }

        .open-indicator {
            color: #667eea;
            font-size: 14px;
            opacity: 0.5;
            transition: opacity 0.3s;
            pointer-events: none; /* So clicks go to parent */
        }

        .bookmark-item:hover .open-indicator {
            opacity: 1;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            background: white;
            border-radius: 10px;
            margin: 10px 0;
        }

        .empty-state i {
            font-size: 40px;
            margin-bottom: 10px;
            color: #e0e0e0;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 13px;
            display: none;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .notification.show {
            display: block;
            animation: fadeInOut 3s ease;
        }

        .notification.error {
            background: #ff4757;
        }

        .notification.success {
            background: #00b894;
        }

        .notification.info {
            background: #3498db;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }

        .loading-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .rules-fix-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            display: none;
            flex-shrink: 0;
        }

        .rules-fix-box.show {
            display: block;
        }

        .rules-fix-box h3 {
            color: #856404;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .rules-fix-box pre {
            background: #fff;
            padding: 8px;
            border-radius: 6px;
            font-size: 10px;
            overflow-x: auto;
            margin: 8px 0;
            border: 1px solid #ffeeba;
        }

        .rules-fix-box button {
            background: #ffc107;
            color: #856404;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            width: 100%;
        }

        /* Scroll Indicator */
        .scroll-indicator {
            text-align: center;
            font-size: 11px;
            color: #999;
            margin-top: 3px;
            display: none;
            flex-shrink: 0;
        }

        .scroll-indicator.show {
            display: block;
        }

        .scroll-indicator i {
            animation: bounce 1s infinite;
            font-size: 10px;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(3px); }
        }

        /* Mobile optimizations - Full screen on mobile */
        @media (max-width: 600px) {
            body {
                padding: 0;
                background: white;
            }
            
            .container {
                padding: 15px;
                border-radius: 0;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <i class="fas fa-bookmark"></i>
            ùó†ùó¨ ùóïùó¢ùó¢ùóûùó†ùóîùó•ùóûùó¶
        </h1>
        <div class="subtitle">
            <i class="fa-brands fa-hackerrank"></i> ùôΩùô∞ùô≥ùô∏ùôº ùô∫ùô∑ùô∞ùôΩ ùôΩ-ùô∑ùô∞ùô≤ùô∫ùô¥ùöÅ ||üáÆüá≥
        </div>

        <!-- Rules Fix Box -->
        <div class="rules-fix-box" id="rulesFixBox">
            <h3><i class="fas fa-exclamation-triangle"></i> Database Permission Error</h3>
            <p>Firebase database rules sahi nahi hain. Ye rules copy karke Firebase Console mein paste karein:</p>
            <pre id="rulesText">{
  "rules": {
    ".read": true,
    ".write": true,
    "bookmarks": {
      ".read": true,
      ".write": true
    }
  }
}</pre>
            <button onclick="copyRules()"><i class="fas fa-copy"></i> Copy Rules</button>
            <p style="margin-top: 8px; font-size: 11px;">
                <i class="fas fa-external-link-alt"></i> 
                <a href="https://console.firebase.google.com/project/hotelg-2befa/database/hotelg-2befa-default-rtdb/rules" target="_blank" style="color: #856404;">
                  Firebase Console
                </a>
            </p>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search bookmarks..." autocomplete="off">
            </div>
            <div class="search-stats" id="searchStats"></div>
        </div>

        <div class="bookmarks-header">
            <h2><i class="fas fa-list"></i> Your Bookmarks</h2>
            <span class="bookmarks-count" id="bookmarkCount">0</span>
        </div>

        <!-- Scrollable Bookmarks Wrapper - Takes remaining space -->
        <div class="bookmarks-wrapper" id="bookmarksWrapper">
            <div class="bookmarks-list" id="bookmarksList">
                <div class="empty-state">
                    <i class="fas fa-bookmark"></i>
                    <p>Loading bookmarks...</p>
                </div>
            </div>
        </div>

        <!-- Scroll Indicator -->
        <div class="scroll-indicator" id="scrollIndicator">
            <i class="fas fa-chevron-down"></i> Scroll for more <i class="fas fa-chevron-down"></i>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC65Zkg11r825qx75FaEZMZcciLTwHZ7nU",
            authDomain: "hotelg-2befa.firebaseapp.com",
            databaseURL: "https://hotelg-2befa-default-rtdb.firebaseio.com",
            projectId: "hotelg-2befa",
            storageBucket: "hotelg-2befa.firebasestorage.app",
            messagingSenderId: "511898248960",
            appId: "1:511898248960:web:265005e18a0b71023035e5",
            measurementId: "G-X9V68C7BFB"
        };

        // Initialize Firebase
        let database;
        let bookmarksRef;
        let firebaseInitialized = false;

        function initializeFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                database = firebase.database();
                bookmarksRef = database.ref('bookmarks');
                firebaseInitialized = true;
                console.log('Firebase initialized successfully');
                return true;
            } catch (error) {
                console.error('Firebase initialization error:', error);
                firebaseInitialized = false;
                return false;
            }
        }

        // Initialize on load
        initializeFirebase();

        // DOM Elements
        const bookmarksWrapper = document.getElementById('bookmarksWrapper');
        const bookmarksList = document.getElementById('bookmarksList');
        const bookmarkCount = document.getElementById('bookmarkCount');
        const notification = document.getElementById('notification');
        const searchInput = document.getElementById('searchInput');
        const searchStats = document.getElementById('searchStats');
        const rulesFixBox = document.getElementById('rulesFixBox');
        const scrollIndicator = document.getElementById('scrollIndicator');

        // Store all bookmarks
        let allBookmarks = [];
        let currentSearchTerm = '';

        // Function to check and show scroll indicator
        function checkScrollIndicator() {
            if (bookmarksWrapper.scrollHeight > bookmarksWrapper.clientHeight) {
                scrollIndicator.classList.add('show');
            } else {
                scrollIndicator.classList.remove('show');
            }
        }

        // Function to show notification
        function showNotification(message, type = 'normal') {
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.classList.add('error');
            } else if (type === 'success') {
                notification.classList.add('success');
            } else if (type === 'info') {
                notification.classList.add('info');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Function to copy rules to clipboard
        function copyRules() {
            const rulesText = document.getElementById('rulesText').textContent;
            navigator.clipboard.writeText(rulesText).then(() => {
                showNotification('Rules copied to clipboard!', 'success');
            }).catch(() => {
                showNotification('Error copying rules', 'error');
            });
        }

        // Function to open URL
        function openUrl(url) {
            try {
                // Ensure URL has protocol
                let urlToOpen = url;
                if (!urlToOpen.startsWith('http://') && !urlToOpen.startsWith('https://')) {
                    urlToOpen = 'https://' + urlToOpen;
                }
                window.open(urlToOpen, '_blank', 'noopener,noreferrer');
            } catch (error) {
                console.error('Error opening URL:', error);
                showNotification('Error opening URL', 'error');
            }
        }

        // Function to escape HTML
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Function to highlight search matches
        function highlightText(text, searchTerm) {
            if (!searchTerm || !text) return escapeHtml(text);
            
            const escapedText = escapeHtml(text);
            const escapedSearchTerm = escapeHtml(searchTerm);
            
            const regex = new RegExp(`(${escapedSearchTerm})`, 'gi');
            return escapedText.replace(regex, '<mark>$1</mark>');
        }

        // Function to filter bookmarks based on search term
        function filterBookmarks(searchTerm) {
            if (!searchTerm) return allBookmarks;
            
            searchTerm = searchTerm.toLowerCase();
            return allBookmarks.filter(bookmark => {
                return (bookmark.title && bookmark.title.toLowerCase().includes(searchTerm)) ||
                       (bookmark.url && bookmark.url.toLowerCase().includes(searchTerm));
            });
        }

        // Function to create bookmark element with search highlighting
        function createBookmarkElement(bookmark, searchTerm) {
            const item = document.createElement('div');
            item.className = 'bookmark-item';
            
            // Add click handler to open URL
            item.addEventListener('click', (e) => {
                // Prevent opening if clicking on interactive elements (though none exist now)
                e.preventDefault();
                openUrl(bookmark.url);
            });
            
            const faviconUrl = bookmark.favicon ? escapeHtml(bookmark.favicon) : '';
            
            // Highlight title and URL if search term exists
            const titleHtml = searchTerm ? highlightText(bookmark.title, searchTerm) : escapeHtml(bookmark.title);
            const urlHtml = searchTerm ? highlightText(bookmark.url, searchTerm) : escapeHtml(bookmark.url);
            
            item.innerHTML = `
                <div class="favicon">
                    ${faviconUrl ? 
                        `<img src="${faviconUrl}" onerror="this.onerror=null; this.parentElement.innerHTML='<i class=\\'fas fa-globe\\'></i>';" alt="favicon">` : 
                        '<i class="fas fa-globe"></i>'}
                </div>
                <div class="bookmark-content">
                    <div class="bookmark-title">${titleHtml || 'Untitled'}</div>
                    <div class="bookmark-url">${urlHtml}</div>
                </div>
                <div class="open-indicator">
                    <i class="fas fa-external-link-alt"></i>
                </div>
            `;

            return item;
        }

        // Function to update bookmarks list
        function updateBookmarksList(snapshot) {
            try {
                const bookmarks = snapshot.val();
                
                if (!bookmarks) {
                    allBookmarks = [];
                    bookmarksList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-bookmark"></i>
                            <p>No bookmarks yet.</p>
                        </div>
                    `;
                    bookmarkCount.textContent = '0';
                    updateSearchStats();
                    checkScrollIndicator();
                    return;
                }

                // Convert to array and store
                allBookmarks = Object.entries(bookmarks)
                    .map(([id, bookmark]) => ({ id, ...bookmark }))
                    .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

                // Apply search filter
                const filteredBookmarks = filterBookmarks(currentSearchTerm);
                
                // Render filtered bookmarks
                bookmarksList.innerHTML = '';
                
                if (filteredBookmarks.length === 0 && currentSearchTerm) {
                    bookmarksList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <p>No bookmarks match "${currentSearchTerm}"</p>
                        </div>
                    `;
                } else if (filteredBookmarks.length === 0) {
                    bookmarksList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-bookmark"></i>
                            <p>No bookmarks yet.</p>
                        </div>
                    `;
                } else {
                    filteredBookmarks.forEach(bookmark => {
                        const element = createBookmarkElement(bookmark, currentSearchTerm);
                        bookmarksList.appendChild(element);
                    });
                }

                // Update counts
                bookmarkCount.textContent = allBookmarks.length;
                updateSearchStats(filteredBookmarks.length);
                
                // Check if scroll indicator should be shown
                setTimeout(checkScrollIndicator, 100);
                
                // Hide rules box if successful
                rulesFixBox.classList.remove('show');
                
            } catch (error) {
                console.error('Error updating bookmarks:', error);
                bookmarksList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading bookmarks</p>
                    </div>
                `;
            }
        }

        // Function to update search statistics
        function updateSearchStats(filteredCount) {
            if (!currentSearchTerm) {
                searchStats.textContent = '';
                return;
            }
            
            if (filteredCount === undefined) {
                filteredCount = filterBookmarks(currentSearchTerm).length;
            }
            
            searchStats.innerHTML = `<span class="search-match">${filteredCount} matches</span> for "${currentSearchTerm}"`;
        }

        // Search input handler with debounce
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            
            searchTimeout = setTimeout(() => {
                currentSearchTerm = e.target.value.trim();
                
                if (currentSearchTerm) {
                    const filtered = filterBookmarks(currentSearchTerm);
                    
                    bookmarksList.innerHTML = '';
                    if (filtered.length === 0) {
                        bookmarksList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-search"></i>
                                <p>No bookmarks match "${currentSearchTerm}"</p>
                            </div>
                        `;
                    } else {
                        filtered.forEach(bookmark => {
                            const element = createBookmarkElement(bookmark, currentSearchTerm);
                            bookmarksList.appendChild(element);
                        });
                    }
                    
                    updateSearchStats(filtered.length);
                } else {
                    // Search empty - show all bookmarks
                    if (allBookmarks.length > 0) {
                        bookmarksList.innerHTML = '';
                        allBookmarks.forEach(bookmark => {
                            const element = createBookmarkElement(bookmark, '');
                            bookmarksList.appendChild(element);
                        });
                    } else {
                        bookmarksList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-bookmark"></i>
                                <p>No bookmarks yet.</p>
                            </div>
                        `;
                    }
                    updateSearchStats();
                }
                checkScrollIndicator();
            }, 300);
        });

        // Listen for scroll to hide indicator
        bookmarksWrapper.addEventListener('scroll', () => {
            if (bookmarksWrapper.scrollTop > 10) {
                scrollIndicator.classList.remove('show');
            }
        });

        // Listen for real-time updates with error handling
        if (bookmarksRef) {
            bookmarksRef.on('value', updateBookmarksList, (error) => {
                console.error('Firebase error:', error);
                
                if (error.code === 'PERMISSION_DENIED') {
                    rulesFixBox.classList.add('show');
                    bookmarksList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-lock"></i>
                            <p>Database permission denied!</p>
                            <p style="font-size: 11px;">Please update Firebase rules.</p>
                        </div>
                    `;
                } else {
                    bookmarksList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Error connecting to database</p>
                        </div>
                    `;
                }
            });
        }

        // Expose functions to global scope
        window.copyRules = copyRules;
    </script>
</body>
</html>